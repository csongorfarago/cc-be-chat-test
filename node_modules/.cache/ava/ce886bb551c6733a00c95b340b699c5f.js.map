{"version":3,"sources":["server.test.js"],"names":["server","require","WebSocket","test","cb","t","ws1","on","open","setTimeout","close","handleClose","reason","pass","end","ws2","send","incoming","message","substring","is","ws3","data","JSON","parse","ws4","ws5","ws6","ws7","messages","ws8","i","push","ws9","forEach","element"],"mappings":"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","file":"server.test.js","sourcesContent":["import test from 'ava';\r\nconst server = require('../server.js');\r\n\r\nconst WebSocket = require('ws');  \r\n\r\ntest.cb('connection', t => {      \r\n    var ws1 = new WebSocket('ws://localhost:8080');    \r\n    ws1.on('open', function open() {\r\n        setTimeout(function () {\r\n          ws1.close();\r\n        }, 5)\r\n    }); \r\n    ws1.on('close', function handleClose(reason) {\r\n        t.pass();\r\n        t.end();        \r\n    });                                                      \r\n})\r\n\r\n\r\ntest.cb('Setting Name', t => {      \r\n    var ws2 = new WebSocket('ws://localhost:8080');\r\n    ws2.on('open', function open() {\r\n        ws2.send('01{\"name\":\"testName123\"}');\r\n    });  \r\n    ws2.on('message', function incoming(message) {\r\n        if(message.substring(0,2) == \"01\"){\r\n            t.is(message.substring(0,24), '01{\"name\":\"testName123\",');  \r\n            t.end();\r\n        }\r\n    });                      \r\n})\r\n\r\n\r\ntest.cb('Sending message', t => {      \r\n    var ws3 = new WebSocket('ws://localhost:8080');\r\n    ws3.on('open', function open() {\r\n        ws3.send('01{\"name\":\"testName123\"}');\r\n        ws3.send('02{\"message\":\"test Message 123\"}');\r\n    });  \r\n    ws3.on('message', function incoming(message) {\r\n        if(message.substring(0,2) == \"02\"){\r\n            var data =  JSON.parse(message.substring(2));  \r\n            if(data['name'] == 'testName123'){         \r\n                t.is(data['name'], 'testName123');\r\n                t.is(data['message'], 'test Message 123');\r\n                t.end();\r\n            }\r\n        }\r\n    });                      \r\n})\r\n\r\n\r\ntest.cb('Sending bad language', t => {      \r\n    var ws4 = new WebSocket('ws://localhost:8080');\r\n    ws4.on('open', function open() {\r\n        ws4.send('01{\"name\":\"badPerson123\"}');\r\n        ws4.send('02{\"message\":\"test ass 12ass3\"}');\r\n    });  \r\n    ws4.on('message', function incoming(message) {\r\n        if(message.substring(0,2) == \"02\"){\r\n            var data =  JSON.parse(message.substring(2));\r\n            if(data['name'] == 'badPerson123'){            \r\n                t.is(data['name'], 'badPerson123');\r\n                t.is(data['message'], 'test *** 12***3');\r\n                t.end();\r\n            }\r\n        }\r\n    });                   \r\n})\r\n\r\n\r\ntest.cb('Sending /popular', t => {      \r\n    var ws5 = new WebSocket('ws://localhost:8080');\r\n    ws5.on('open', function open() {\r\n        ws5.send(\"03{}\");\r\n    });  \r\n    ws5.on('message', function incoming(message) {\r\n        if(message.substring(0,2) == \"04\"){\r\n            var data =  JSON.parse(message.substring(2));         \r\n            t.is(data['word'], 'test');\r\n            t.is(data['count'], 2);\r\n            t.end();\r\n        }        \r\n    });                     \r\n})\r\n\r\ntest.cb('Sending /stats with no user', t => {      \r\n    var ws6 = new WebSocket('ws://localhost:8080');\r\n    ws6.on('open', function open() {\r\n        ws6.send(\"04{}\");\r\n    });  \r\n    ws6.on('message', function incoming(message) {\r\n        if(message.substring(0,2) == \"05\"){\r\n            var data =  JSON.parse(message.substring(2));         \r\n            t.is(data['error'], 'client not found');\r\n            t.end();\r\n        }     \r\n    });                     \r\n})\r\n\r\ntest.cb('Sending /stats with user', t => {      \r\n    var ws7 = new WebSocket('ws://localhost:8080');\r\n    ws7.on('open', function open() {\r\n        ws7.send('01{\"name\":\"timedPerson123\"}');\r\n        ws7.send('04{\"name\":\"timedPerson123\"}');\r\n    });  \r\n    ws7.on('message', function incoming(message) {\r\n        if(message.substring(0,2) == \"05\"){\r\n            var data =  JSON.parse(message.substring(2));         \r\n            if(data['time']){\r\n                t.pass();\r\n            }\r\n            t.end();\r\n        }     \r\n    });                     \r\n})\r\n\r\ntest.cb('testing message history', t => {  \r\n    var messages = [];    \r\n    var ws8 = new WebSocket('ws://localhost:8080');\r\n    ws8.on('open', function open() {\r\n        ws8.send('01{\"name\":\"Spammer123\"}');\r\n        for(var i = 0; i<100; i++){\r\n            ws8.send('02{\"message\":\"spam'+i+'\"}');\r\n            \r\n            var message = {};\r\n            message['name'] = \"Spammer123\"; \r\n            message['message'] = \"spam\"+i;            \r\n            messages.push(message);\r\n        }\r\n    });  \r\n\r\n    setTimeout(function () {\r\n        var ws9 = new WebSocket('ws://localhost:8080'); \r\n        ws9.on('message', function incoming(message) {\r\n            if(message.substring(0,2) == \"03\"){\r\n                var data =  JSON.parse(message.substring(2)); \r\n                var i = 50;\r\n                data.forEach(function (element){\r\n                    t.is(element['name'], messages[i]['name']);\r\n                    t.is(element['message'], messages[i++]['message']);\r\n                });        \r\n                t.end();\r\n            }   \r\n        });    \r\n    }, 50)                         \r\n})"]}