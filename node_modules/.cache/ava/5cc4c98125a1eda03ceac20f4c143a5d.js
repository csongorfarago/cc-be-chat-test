'use strict';

var _ava = require('ava');

var _ava2 = _interopRequireDefault(_ava);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const server = require('../server.js');

const WebSocket = require('ws');

_ava2.default.cb('connection', t => {
    var ws1 = new WebSocket('ws://localhost:8080');
    ws1.on('open', function open() {
        t.pass();
        t.end();
    });
    ws1.on('error', function handleError(error) {
        t.fail(error);
    });
    ws1.on('close', function handleClose(reason) {
        t.end();
    });
});

_ava2.default.cb('Setting Name', t => {
    var ws2 = new WebSocket('ws://localhost:8080');
    ws2.on('open', function open() {
        ws2.send('01{"name":"testName123"}');
    });
    ws2.on('message', function incoming(message) {
        if (message.substring(0, 2) == "01") {
            t.is(message.substring(0, 24), '01{"name":"testName123",');
            t.end();
        }
    });

    ws2.on('error', function handleError(error) {
        t.fail(error);
    });
    ws2.on('close', function handleClose(reason) {
        t.end();
    });
});

_ava2.default.cb('Sending message', t => {
    var ws3 = new WebSocket('ws://localhost:8080');
    ws3.on('open', function open() {
        ws3.send('01{"name":"testName123"}');
        ws3.send('02{"message":"test Message 123"}');
    });
    ws3.on('message', function incoming(message) {
        console.log(message);
        if (message.substring(0, 2) == "02") {
            var data = JSON.parse(message.substring(2));
            t.is(data['name'], 'testName123');
            t.is(data['message'], 'test Message 123');
            t.end();
        }
    });

    ws3.on('error', function handleError(error) {
        t.fail(error);
    });
    ws3.on('close', function handleClose(reason) {
        t.end();
    });
});
//# sourceMappingURL=..\node_modules\.cache\ava\5cc4c98125a1eda03ceac20f4c143a5d.js.map