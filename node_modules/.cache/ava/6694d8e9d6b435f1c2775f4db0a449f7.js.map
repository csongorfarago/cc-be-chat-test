{"version":3,"sources":["server.test.js"],"names":["server","require","WebSocket","test","cb","t","ws1","on","open","pass","end","handleError","error","fail","handleClose","reason","ws2","send","incoming","message","substring","is","ws3","console","log","data","JSON","parse","ws4","ws5"],"mappings":"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","file":"server.test.js","sourcesContent":["import test from 'ava';\r\nconst server = require('../server.js');\r\n\r\nconst WebSocket = require('ws');  \r\n\r\ntest.cb('connection', t => {      \r\n    var ws1 = new WebSocket('ws://localhost:8080');\r\n    ws1.on('open', function open() {\r\n        t.pass();\r\n        t.end();\r\n    });  \r\n    ws1.on('error', function handleError(error) {\r\n        t.fail(error);\r\n    });      \r\n    ws1.on('close', function handleClose(reason) {\r\n        t.end();\r\n    });       \r\n})\r\n\r\n\r\ntest.cb('Setting Name', t => {      \r\n    var ws2 = new WebSocket('ws://localhost:8080');\r\n    ws2.on('open', function open() {\r\n        ws2.send('01{\"name\":\"testName123\"}');\r\n    });  \r\n    ws2.on('message', function incoming(message) {\r\n        if(message.substring(0,2) == \"01\"){\r\n            t.is(message.substring(0,24), '01{\"name\":\"testName123\",');  \r\n            t.end();\r\n        }\r\n    }); \r\n    \r\n    ws2.on('error', function handleError(error) {\r\n        t.fail(error);\r\n    });      \r\n    ws2.on('close', function handleClose(reason) {\r\n        t.end();\r\n    });                     \r\n})\r\n\r\n\r\ntest.cb('Sending message', t => {      \r\n    var ws3 = new WebSocket('ws://localhost:8080');\r\n    ws3.on('open', function open() {\r\n        ws3.send('01{\"name\":\"testName123\"}');\r\n        ws3.send('02{\"message\":\"test Message 123\"}');\r\n    });  \r\n    ws3.on('message', function incoming(message) {\r\n        console.log(message)\r\n        if(message.substring(0,2) == \"02\"){\r\n            var data =  JSON.parse(message.substring(2));  \r\n            if(data['name'] == 'testName123'){         \r\n                t.is(data['name'], 'testName123');\r\n                t.is(data['message'], 'test Message 123');\r\n                t.end();\r\n            }\r\n        }\r\n    });  \r\n    \r\n    ws3.on('error', function handleError(error) {\r\n        t.fail(error);\r\n    });      \r\n    ws3.on('close', function handleClose(reason) {\r\n        t.end();\r\n    });                    \r\n})\r\n\r\n\r\ntest.cb('Sending bad language', t => {      \r\n    var ws4 = new WebSocket('ws://localhost:8080');\r\n    ws4.on('open', function open() {\r\n        ws4.send('01{\"name\":\"badPerson123\"}');\r\n        ws4.send('02{\"message\":\"test ass 12ass3\"}');\r\n    });  \r\n    ws4.on('message', function incoming(message) {\r\n        console.log(message)\r\n        if(message.substring(0,2) == \"02\"){\r\n            var data =  JSON.parse(message.substring(2));\r\n            if(data['name'] == 'badPerson123'){            \r\n                t.is(data['name'], 'badPerson123');\r\n                t.is(data['message'], 'test *** 12***3');\r\n                t.end();\r\n            }\r\n        }\r\n    });  \r\n    \r\n    ws4.on('error', function handleError(error) {\r\n        t.fail(error);\r\n    });      \r\n    ws4.on('close', function handleClose(reason) {\r\n        t.end();\r\n    });                    \r\n})\r\n\r\n\r\ntest.cb('Sending /popular', t => {      \r\n    var ws5 = new WebSocket('ws://localhost:8080');\r\n    ws5.on('open', function open() {\r\n        ws5.send('04');\r\n    });  \r\n    ws5.on('message', function incoming(message) {\r\n        console.log(message)\r\n    });  \r\n    \r\n    ws5.on('error', function handleError(error) {\r\n        t.fail(error);\r\n    });      \r\n    ws5.on('close', function handleClose(reason) {\r\n        t.end();\r\n    });                    \r\n})"]}