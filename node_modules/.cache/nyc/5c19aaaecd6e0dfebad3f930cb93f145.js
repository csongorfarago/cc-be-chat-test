var cov_1hrcj0p82x=function(){var path="C:\\work\\chat-test\\server.js",hash="b3dc3dcd973131591a515a506fb0b0f0bf4bf598",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"C:\\work\\chat-test\\server.js",statementMap:{"0":{start:{line:4,column:11},end:{line:4,column:24}},"1":{start:{line:5,column:15},end:{line:5,column:17}},"2":{start:{line:8,column:0},end:{line:13,column:3}},"3":{start:{line:9,column:4},end:{line:9,column:38}},"4":{start:{line:10,column:4},end:{line:10,column:53}},"5":{start:{line:11,column:4},end:{line:11,column:63}},"6":{start:{line:12,column:4},end:{line:12,column:65}},"7":{start:{line:16,column:18},end:{line:16,column:31}},"8":{start:{line:17,column:13},end:{line:17,column:17}},"9":{start:{line:18,column:15},end:{line:18,column:51}},"10":{start:{line:20,column:15},end:{line:20,column:17}},"11":{start:{line:21,column:14},end:{line:21,column:16}},"12":{start:{line:23,column:0},end:{line:127,column:3}},"13":{start:{line:25,column:4},end:{line:25,column:36}},"14":{start:{line:27,column:17},end:{line:27,column:19}},"15":{start:{line:28,column:4},end:{line:28,column:31}},"16":{start:{line:29,column:4},end:{line:29,column:32}},"17":{start:{line:30,column:4},end:{line:30,column:32}},"18":{start:{line:33,column:4},end:{line:33,column:49}},"19":{start:{line:36,column:4},end:{line:121,column:7}},"20":{start:{line:38,column:19},end:{line:38,column:42}},"21":{start:{line:39,column:19},end:{line:39,column:51}},"22":{start:{line:40,column:8},end:{line:40,column:95}},"23":{start:{line:43,column:8},end:{line:47,column:9}},"24":{start:{line:44,column:12},end:{line:46,column:13}},"25":{start:{line:45,column:16},end:{line:45,column:58}},"26":{start:{line:50,column:8},end:{line:67,column:9}},"27":{start:{line:51,column:23},end:{line:51,column:49}},"28":{start:{line:52,column:26},end:{line:55,column:13}},"29":{start:{line:58,column:12},end:{line:60,column:13}},"30":{start:{line:59,column:16},end:{line:59,column:33}},"31":{start:{line:61,column:12},end:{line:61,column:35}},"32":{start:{line:64,column:12},end:{line:66,column:15}},"33":{start:{line:65,column:16},end:{line:65,column:60}},"34":{start:{line:70,column:8},end:{line:96,column:9}},"35":{start:{line:71,column:20},end:{line:71,column:22}},"36":{start:{line:72,column:23},end:{line:72,column:40}},"37":{start:{line:73,column:12},end:{line:77,column:13}},"38":{start:{line:74,column:16},end:{line:76,column:17}},"39":{start:{line:75,column:20},end:{line:75,column:54}},"40":{start:{line:79,column:29},end:{line:79,column:31}},"41":{start:{line:80,column:24},end:{line:80,column:37}},"42":{start:{line:82,column:26},end:{line:82,column:28}},"43":{start:{line:83,column:12},end:{line:83,column:33}},"44":{start:{line:84,column:12},end:{line:84,column:33}},"45":{start:{line:86,column:12},end:{line:93,column:13}},"46":{start:{line:87,column:24},end:{line:87,column:46}},"47":{start:{line:88,column:16},end:{line:88,column:69}},"48":{start:{line:89,column:16},end:{line:92,column:17}},"49":{start:{line:90,column:20},end:{line:90,column:40}},"50":{start:{line:91,column:20},end:{line:91,column:59}},"51":{start:{line:95,column:12},end:{line:95,column:56}},"52":{start:{line:99,column:8},end:{line:120,column:9}},"53":{start:{line:102,column:12},end:{line:106,column:13}},"54":{start:{line:103,column:16},end:{line:105,column:17}},"55":{start:{line:104,column:20},end:{line:104,column:46}},"56":{start:{line:108,column:12},end:{line:119,column:13}},"57":{start:{line:110,column:29},end:{line:110,column:31}},"58":{start:{line:111,column:16},end:{line:111,column:53}},"59":{start:{line:112,column:16},end:{line:112,column:66}},"60":{start:{line:113,column:16},end:{line:113,column:59}},"61":{start:{line:116,column:29},end:{line:116,column:31}},"62":{start:{line:117,column:16},end:{line:117,column:53}},"63":{start:{line:118,column:16},end:{line:118,column:59}},"64":{start:{line:124,column:4},end:{line:126,column:7}},"65":{start:{line:125,column:8},end:{line:125,column:66}},"66":{start:{line:130,column:0},end:{line:130,column:59}},"67":{start:{line:134,column:4},end:{line:136,column:7}},"68":{start:{line:135,column:8},end:{line:135,column:42}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:8,column:43},end:{line:8,column:44}},loc:{start:{line:8,column:68},end:{line:13,column:1}},line:8},"1":{name:"connection",decl:{start:{line:23,column:33},end:{line:23,column:43}},loc:{start:{line:23,column:52},end:{line:127,column:1}},line:23},"2":{name:"incoming",decl:{start:{line:36,column:34},end:{line:36,column:42}},loc:{start:{line:36,column:52},end:{line:121,column:5}},line:36},"3":{name:"(anonymous_3)",decl:{start:{line:64,column:35},end:{line:64,column:36}},loc:{start:{line:64,column:53},end:{line:66,column:13}},line:64},"4":{name:"incoming",decl:{start:{line:124,column:32},end:{line:124,column:40}},loc:{start:{line:124,column:50},end:{line:126,column:5}},line:124},"5":{name:"profanity",decl:{start:{line:133,column:9},end:{line:133,column:18}},loc:{start:{line:133,column:28},end:{line:137,column:1}},line:133},"6":{name:"(anonymous_6)",decl:{start:{line:134,column:38},end:{line:134,column:39}},loc:{start:{line:134,column:51},end:{line:136,column:5}},line:134}},branchMap:{"0":{loc:{start:{line:43,column:8},end:{line:47,column:9}},type:"if",locations:[{start:{line:43,column:8},end:{line:47,column:9}},{start:{line:43,column:8},end:{line:47,column:9}}],line:43},"1":{loc:{start:{line:44,column:12},end:{line:46,column:13}},type:"if",locations:[{start:{line:44,column:12},end:{line:46,column:13}},{start:{line:44,column:12},end:{line:46,column:13}}],line:44},"2":{loc:{start:{line:50,column:8},end:{line:67,column:9}},type:"if",locations:[{start:{line:50,column:8},end:{line:67,column:9}},{start:{line:50,column:8},end:{line:67,column:9}}],line:50},"3":{loc:{start:{line:58,column:12},end:{line:60,column:13}},type:"if",locations:[{start:{line:58,column:12},end:{line:60,column:13}},{start:{line:58,column:12},end:{line:60,column:13}}],line:58},"4":{loc:{start:{line:70,column:8},end:{line:96,column:9}},type:"if",locations:[{start:{line:70,column:8},end:{line:96,column:9}},{start:{line:70,column:8},end:{line:96,column:9}}],line:70},"5":{loc:{start:{line:74,column:16},end:{line:76,column:17}},type:"if",locations:[{start:{line:74,column:16},end:{line:76,column:17}},{start:{line:74,column:16},end:{line:76,column:17}}],line:74},"6":{loc:{start:{line:88,column:39},end:{line:88,column:63}},type:"binary-expr",locations:[{start:{line:88,column:39},end:{line:88,column:58}},{start:{line:88,column:62},end:{line:88,column:63}}],line:88},"7":{loc:{start:{line:89,column:16},end:{line:92,column:17}},type:"if",locations:[{start:{line:89,column:16},end:{line:92,column:17}},{start:{line:89,column:16},end:{line:92,column:17}}],line:89},"8":{loc:{start:{line:89,column:20},end:{line:89,column:70}},type:"binary-expr",locations:[{start:{line:89,column:20},end:{line:89,column:58}},{start:{line:89,column:62},end:{line:89,column:70}}],line:89},"9":{loc:{start:{line:99,column:8},end:{line:120,column:9}},type:"if",locations:[{start:{line:99,column:8},end:{line:120,column:9}},{start:{line:99,column:8},end:{line:120,column:9}}],line:99},"10":{loc:{start:{line:103,column:16},end:{line:105,column:17}},type:"if",locations:[{start:{line:103,column:16},end:{line:105,column:17}},{start:{line:103,column:16},end:{line:105,column:17}}],line:103},"11":{loc:{start:{line:108,column:12},end:{line:119,column:13}},type:"if",locations:[{start:{line:108,column:12},end:{line:119,column:13}},{start:{line:108,column:12},end:{line:119,column:13}}],line:108}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();import test from'tests/serverTest';//Getting PROFANITY regex ready for use
const fs=(cov_1hrcj0p82x.s[0]++,require('fs'));var BADWORDS=(cov_1hrcj0p82x.s[1]++,[]);var PROFANITY;var CENZOR;cov_1hrcj0p82x.s[2]++;fs.readFile("assets/badwords.txt","utf8",function(err,contents){cov_1hrcj0p82x.f[0]++;cov_1hrcj0p82x.s[3]++;BADWORDS=contents.split('\r\n');cov_1hrcj0p82x.s[4]++;PROFANITY=new RegExp(BADWORDS.join("|"),"gi");cov_1hrcj0p82x.s[5]++;CENZOR="**********************".split("").join("******");cov_1hrcj0p82x.s[6]++;console.log('Profanity words list loaded and filter set up');});//Setting up Websocket
const WebSocket=(cov_1hrcj0p82x.s[7]++,require('ws'));const PORT=(cov_1hrcj0p82x.s[8]++,8080);const server=(cov_1hrcj0p82x.s[9]++,new WebSocket.Server({port:PORT}));var messages=(cov_1hrcj0p82x.s[10]++,[]);var clients=(cov_1hrcj0p82x.s[11]++,{});cov_1hrcj0p82x.s[12]++;server.on('connection',function connection(socket){cov_1hrcj0p82x.f[1]++;cov_1hrcj0p82x.s[13]++;//Handle new connections
console.log("Client connected");var client=(cov_1hrcj0p82x.s[14]++,{});cov_1hrcj0p82x.s[15]++;client['name']="Unknown";cov_1hrcj0p82x.s[16]++;client['join']=Date.now();cov_1hrcj0p82x.s[17]++;clients[socket.id]=client;//sending chat history
cov_1hrcj0p82x.s[18]++;socket.send("03"+JSON.stringify(messages));//Handle messages from clients  
cov_1hrcj0p82x.s[19]++;socket.on('message',function incoming(message){cov_1hrcj0p82x.f[2]++;//decoding message
var code=(cov_1hrcj0p82x.s[20]++,message.substring(0,2));var data=(cov_1hrcj0p82x.s[21]++,JSON.parse(message.substring(2)));cov_1hrcj0p82x.s[22]++;console.log('received:{ code: '+code+' , message: '+JSON.stringify(data)+' }');//Code 01 - client settings
cov_1hrcj0p82x.s[23]++;if(code=="01"){cov_1hrcj0p82x.b[0][0]++;cov_1hrcj0p82x.s[24]++;if(data['name']){cov_1hrcj0p82x.b[1][0]++;cov_1hrcj0p82x.s[25]++;clients[socket.id]['name']=data['name'];}else{cov_1hrcj0p82x.b[1][1]++;}}else{cov_1hrcj0p82x.b[0][1]++;}//Code 02 - chat message
cov_1hrcj0p82x.s[26]++;if(code=="02"){cov_1hrcj0p82x.b[2][0]++;var text=(cov_1hrcj0p82x.s[27]++,profanity(data['message']));var message=(cov_1hrcj0p82x.s[28]++,{"name":clients[socket.id]['name'],"message":text,"time":Date.now()});//keeping last 50 messages
cov_1hrcj0p82x.s[29]++;if(messages.length>=50){cov_1hrcj0p82x.b[3][0]++;cov_1hrcj0p82x.s[30]++;messages.shift();}else{cov_1hrcj0p82x.b[3][1]++;}cov_1hrcj0p82x.s[31]++;messages.push(message);//sending message object to everyone
cov_1hrcj0p82x.s[32]++;server.clients.forEach(function(client){cov_1hrcj0p82x.f[3]++;cov_1hrcj0p82x.s[33]++;client.send("02"+JSON.stringify(message));});}else{cov_1hrcj0p82x.b[2][1]++;}//Code 03 - /popular command 
cov_1hrcj0p82x.s[34]++;if(code=="03"){cov_1hrcj0p82x.b[4][0]++;var s=(cov_1hrcj0p82x.s[35]++,"");var time=(cov_1hrcj0p82x.s[36]++,Date.now()-5000);cov_1hrcj0p82x.s[37]++;for(var i=messages.length-1;i>=0;i--){cov_1hrcj0p82x.s[38]++;if(messages[i]['time']>=time){cov_1hrcj0p82x.b[5][0]++;cov_1hrcj0p82x.s[39]++;s+=messages[i]['message']+" ";}else{cov_1hrcj0p82x.b[5][1]++;}}var wordCounts=(cov_1hrcj0p82x.s[40]++,{});var words=(cov_1hrcj0p82x.s[41]++,s.split(/\b/));var popular=(cov_1hrcj0p82x.s[42]++,{});cov_1hrcj0p82x.s[43]++;popular['word']="";cov_1hrcj0p82x.s[44]++;popular['count']=0;cov_1hrcj0p82x.s[45]++;for(var i=0;i<words.length;i++){var w=(cov_1hrcj0p82x.s[46]++,words[i].toLowerCase());cov_1hrcj0p82x.s[47]++;wordCounts["_"+w]=((cov_1hrcj0p82x.b[6][0]++,wordCounts["_"+w])||(cov_1hrcj0p82x.b[6][1]++,0))+1;cov_1hrcj0p82x.s[48]++;if((cov_1hrcj0p82x.b[8][0]++,wordCounts["_"+w]>popular['count'])&&(cov_1hrcj0p82x.b[8][1]++,w!=" ")){cov_1hrcj0p82x.b[7][0]++;cov_1hrcj0p82x.s[49]++;popular['word']=w;cov_1hrcj0p82x.s[50]++;popular['count']=wordCounts["_"+w];}else{cov_1hrcj0p82x.b[7][1]++;}}cov_1hrcj0p82x.s[51]++;socket.send("04"+JSON.stringify(popular));}else{cov_1hrcj0p82x.b[4][1]++;}//Code 04 - /stats command 
cov_1hrcj0p82x.s[52]++;if(code=="04"){cov_1hrcj0p82x.b[9][0]++;//look for client
var clientFound;cov_1hrcj0p82x.s[53]++;for(var id in clients){cov_1hrcj0p82x.s[54]++;if(clients[id]['name']==data['name']){cov_1hrcj0p82x.b[10][0]++;cov_1hrcj0p82x.s[55]++;clientFound=clients[id];}else{cov_1hrcj0p82x.b[10][1]++;}}cov_1hrcj0p82x.s[56]++;if(clientFound){cov_1hrcj0p82x.b[11][0]++;//client found    
var answer=(cov_1hrcj0p82x.s[57]++,{});cov_1hrcj0p82x.s[58]++;answer['name']=clientFound['name'];cov_1hrcj0p82x.s[59]++;answer['time']=Date.now()-clientFound['join'];cov_1hrcj0p82x.s[60]++;socket.send("05"+JSON.stringify(answer));}else{cov_1hrcj0p82x.b[11][1]++;//client not found
var answer=(cov_1hrcj0p82x.s[61]++,{});cov_1hrcj0p82x.s[62]++;answer['error']="client not found";cov_1hrcj0p82x.s[63]++;socket.send("05"+JSON.stringify(answer));}}else{cov_1hrcj0p82x.b[9][1]++;}});//Handle disconncetions from clients  
cov_1hrcj0p82x.s[64]++;socket.on('close',function incoming(message){cov_1hrcj0p82x.f[4]++;cov_1hrcj0p82x.s[65]++;console.log('Client disconnected with code: %s',message);});});//Server is fully set up
cov_1hrcj0p82x.s[66]++;console.log("Chat server is running at localhost:"+PORT);//Helper functions
function profanity(message){cov_1hrcj0p82x.f[5]++;cov_1hrcj0p82x.s[67]++;return message.replace(PROFANITY,function(m){cov_1hrcj0p82x.f[6]++;cov_1hrcj0p82x.s[68]++;return CENZOR.substr(0,m.length);});}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlci5qcyJdLCJuYW1lcyI6WyJ0ZXN0IiwiZnMiLCJyZXF1aXJlIiwiQkFEV09SRFMiLCJQUk9GQU5JVFkiLCJDRU5aT1IiLCJyZWFkRmlsZSIsImVyciIsImNvbnRlbnRzIiwic3BsaXQiLCJSZWdFeHAiLCJqb2luIiwiY29uc29sZSIsImxvZyIsIldlYlNvY2tldCIsIlBPUlQiLCJzZXJ2ZXIiLCJTZXJ2ZXIiLCJwb3J0IiwibWVzc2FnZXMiLCJjbGllbnRzIiwib24iLCJjb25uZWN0aW9uIiwic29ja2V0IiwiY2xpZW50IiwiRGF0ZSIsIm5vdyIsImlkIiwic2VuZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJpbmNvbWluZyIsIm1lc3NhZ2UiLCJjb2RlIiwic3Vic3RyaW5nIiwiZGF0YSIsInBhcnNlIiwidGV4dCIsInByb2Zhbml0eSIsImxlbmd0aCIsInNoaWZ0IiwicHVzaCIsImZvckVhY2giLCJzIiwidGltZSIsImkiLCJ3b3JkQ291bnRzIiwid29yZHMiLCJwb3B1bGFyIiwidyIsInRvTG93ZXJDYXNlIiwiY2xpZW50Rm91bmQiLCJhbnN3ZXIiLCJyZXBsYWNlIiwibSIsInN1YnN0ciJdLCJtYXBwaW5ncyI6IkFBQUEsT0FBT0EsSUFBUCxNQUFpQixrQkFBakI7O0FBRUE7QUFDQSxNQUFNQyxLQUFLQyxRQUFRLElBQVIsQ0FBWDtBQUNBLElBQUlDLFdBQVcsRUFBZjtBQUNBLElBQUlDLFNBQUo7QUFDQSxJQUFJQyxNQUFKO0FBQ0FKLEdBQUdLLFFBQUgsQ0FBWSxxQkFBWixFQUFtQyxNQUFuQyxFQUEyQyxVQUFTQyxHQUFULEVBQWNDLFFBQWQsRUFBd0I7QUFDL0RMLGVBQVdLLFNBQVNDLEtBQVQsQ0FBZSxNQUFmLENBQVg7QUFDQUwsZ0JBQWEsSUFBSU0sTUFBSixDQUFZUCxTQUFTUSxJQUFULENBQWMsR0FBZCxDQUFaLEVBQWdDLElBQWhDLENBQWI7QUFDQU4sYUFBVSx3QkFBRCxDQUEyQkksS0FBM0IsQ0FBaUMsRUFBakMsRUFBcUNFLElB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QUEsdUJBQU8sT0FBUCxJQUFrQixrQkFBbEI7QUFDQTdCLHVCQUFPSyxJQUFQLENBQVksT0FBS0MsS0FBS0MsU0FBTCxDQUFlc0IsTUFBZixDQUFqQjtBQUNIO0FBQ0o7QUFFRixLQXRGRDs7QUF3RkE7QUFDQTdCLFdBQU9GLEVBQVAsQ0FBVSxPQUFWLEVBQW1CLFNBQVNVLFFBQVQsQ0FBa0JDLE9BQWxCLEVBQTJCO0FBQzVDcEIsZ0JBQVFDLEdBQVIsQ0FBWSxtQ0FBWixFQUFpRG1CLE9BQWpEO0FBQ0QsS0FGRDtBQUlELENBNUdEOztBQThHQTtBQUNBcEIsUUFBUUMsR0FBUixDQUFZLHlDQUF1Q0UsSUFBbkQ7O0FBR0E7QUFDQSxTQUFTdUIsU0FBVCxDQUFtQk4sT0FBbkIsRUFBMkI7QUFDdkIsV0FBT0EsUUFBUXFCLE9BQVIsQ0FBZ0JqRCxTQUFoQixFQUEyQixVQUFTa0QsQ0FBVCxFQUFZO0FBQzFDLGVBQU9qRCxPQUFPa0QsTUFBUCxDQUFjLENBQWQsRUFBaUJELEVBQUVmLE1BQW5CLENBQVA7QUFDSCxLQUZNLENBQVA7QUFHSCIsImZpbGUiOiJzZXJ2ZXIuanMiLCJzb3VyY2VSb290IjoiQzovd29yay9jaGF0LXRlc3QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdGVzdCBmcm9tICd0ZXN0cy9zZXJ2ZXJUZXN0JztcclxuXHJcbi8vR2V0dGluZyBQUk9GQU5JVFkgcmVnZXggcmVhZHkgZm9yIHVzZVxyXG5jb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XHJcbnZhciBCQURXT1JEUyA9IFtdO1xyXG52YXIgUFJPRkFOSVRZO1xyXG52YXIgQ0VOWk9SO1xyXG5mcy5yZWFkRmlsZShcImFzc2V0cy9iYWR3b3Jkcy50eHRcIiwgXCJ1dGY4XCIsIGZ1bmN0aW9uKGVyciwgY29udGVudHMpIHtcclxuICAgIEJBRFdPUkRTID0gY29udGVudHMuc3BsaXQoJ1xcclxcbicpO1xyXG4gICAgUFJPRkFOSVRZICA9IG5ldyBSZWdFeHAoIEJBRFdPUkRTLmpvaW4oXCJ8XCIpICxcImdpXCIpO1xyXG4gICAgQ0VOWk9SID0gKFwiKioqKioqKioqKioqKioqKioqKioqKlwiKS5zcGxpdChcIlwiKS5qb2luKFwiKioqKioqXCIpO1xyXG4gICAgY29uc29sZS5sb2coJ1Byb2Zhbml0eSB3b3JkcyBsaXN0IGxvYWRlZCBhbmQgZmlsdGVyIHNldCB1cCcpO1xyXG59KTtcclxuXHJcbi8vU2V0dGluZyB1cCBXZWJzb2NrZXRcclxuY29uc3QgV2ViU29ja2V0ID0gcmVxdWlyZSgnd3MnKTtcclxuY29uc3QgUE9SVCA9IDgwODA7IFxyXG5jb25zdCBzZXJ2ZXIgPSBuZXcgV2ViU29ja2V0LlNlcnZlcih7IHBvcnQ6IFBPUlQgfSk7XHJcbiBcclxudmFyIG1lc3NhZ2VzID0gW107IFxyXG52YXIgY2xpZW50cyA9IHt9O1xyXG4gXHJcbnNlcnZlci5vbignY29ubmVjdGlvbicsIGZ1bmN0aW9uIGNvbm5lY3Rpb24oc29ja2V0KSB7XHJcbiAgLy9IYW5kbGUgbmV3IGNvbm5lY3Rpb25zXHJcbiAgY29uc29sZS5sb2coXCJDbGllbnQgY29ubmVjdGVkXCIpO1xyXG4gIFxyXG4gICAgdmFyIGNsaWVudCA9IHt9O1xyXG4gICAgY2xpZW50WyduYW1lJ10gPSBcIlVua25vd25cIjtcclxuICAgIGNsaWVudFsnam9pbiddID0gRGF0ZS5ub3coKTtcclxuICAgIGNsaWVudHNbc29ja2V0LmlkXSA9IGNsaWVudDsgICAgXHJcbiAgICBcclxuIFxyXG4gIC8vc2VuZGluZyBjaGF0IGhpc3RvcnlcclxuICBzb2NrZXQuc2VuZChcIjAzXCIrSlNPTi5zdHJpbmdpZnkobWVzc2FnZXMpKTtcclxuICAgXHJcbiAgIFxyXG4gIC8vSGFuZGxlIG1lc3NhZ2VzIGZyb20gY2xpZW50cyAgXHJcbiAgc29ja2V0Lm9uKCdtZXNzYWdlJywgZnVuY3Rpb24gaW5jb21pbmcobWVzc2FnZSkge1xyXG4gICAgLy9kZWNvZGluZyBtZXNzYWdlXHJcbiAgICB2YXIgY29kZSA9ICBtZXNzYWdlLnN1YnN0cmluZygwLCAyKTtcclxuICAgIHZhciBkYXRhID0gIEpTT04ucGFyc2UobWVzc2FnZS5zdWJzdHJpbmcoMikpO1xyXG4gICAgY29uc29sZS5sb2coJ3JlY2VpdmVkOnsgY29kZTogJytjb2RlKycgLCBtZXNzYWdlOiAnKyBKU09OLnN0cmluZ2lmeShkYXRhKSArJyB9Jyk7XHJcbiBcclxuICAgIC8vQ29kZSAwMSAtIGNsaWVudCBzZXR0aW5nc1xyXG4gICAgaWYoY29kZSA9PSBcIjAxXCIpe1xyXG4gICAgICAgIGlmKGRhdGFbJ25hbWUnXSl7XHJcbiAgICAgICAgICAgIGNsaWVudHNbc29ja2V0LmlkXVsnbmFtZSddID0gZGF0YVsnbmFtZSddOyBcclxuICAgICAgICB9ICAgICAgIFxyXG4gICAgfSBcclxuICAgIFxyXG4gICAgLy9Db2RlIDAyIC0gY2hhdCBtZXNzYWdlXHJcbiAgICBpZihjb2RlID09IFwiMDJcIil7XHJcbiAgICAgICAgdmFyIHRleHQgPSBwcm9mYW5pdHkoZGF0YVsnbWVzc2FnZSddKTtcclxuICAgICAgICB2YXIgbWVzc2FnZSA9IHsgXCJuYW1lXCI6IGNsaWVudHNbc29ja2V0LmlkXVsnbmFtZSddLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJtZXNzYWdlXCI6IHRleHQsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRpbWVcIjogRGF0ZS5ub3coKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9OyAgICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICAvL2tlZXBpbmcgbGFzdCA1MCBtZXNzYWdlc1xyXG4gICAgICAgIGlmKG1lc3NhZ2VzLmxlbmd0aCA+PSA1MCl7XHJcbiAgICAgICAgICAgIG1lc3NhZ2VzLnNoaWZ0KCk7ICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7IFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vc2VuZGluZyBtZXNzYWdlIG9iamVjdCB0byBldmVyeW9uZVxyXG4gICAgICAgIHNlcnZlci5jbGllbnRzLmZvckVhY2goZnVuY3Rpb24oY2xpZW50KSB7XHJcbiAgICAgICAgICAgIGNsaWVudC5zZW5kKFwiMDJcIitKU09OLnN0cmluZ2lmeShtZXNzYWdlKSk7XHJcbiAgICAgICAgfSk7ICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vQ29kZSAwMyAtIC9wb3B1bGFyIGNvbW1hbmQgXHJcbiAgICBpZihjb2RlID09IFwiMDNcIil7XHJcbiAgICAgICAgdmFyIHMgPSBcIlwiO1xyXG4gICAgICAgIHZhciB0aW1lID0gRGF0ZS5ub3coKSAtIDUwMDA7XHJcbiAgICAgICAgZm9yKHZhciBpID0gbWVzc2FnZXMubGVuZ3RoLTE7IGkgPj0gMDsgaS0tKXtcclxuICAgICAgICAgICAgaWYobWVzc2FnZXNbaV1bJ3RpbWUnXSA+PSB0aW1lKXtcclxuICAgICAgICAgICAgICAgIHMrPSBtZXNzYWdlc1tpXVsnbWVzc2FnZSddICsgXCIgXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ICAgICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciB3b3JkQ291bnRzID0geyB9O1xyXG4gICAgICAgIHZhciB3b3JkcyA9IHMuc3BsaXQoL1xcYi8pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciBwb3B1bGFyID0ge307XHJcbiAgICAgICAgcG9wdWxhclsnd29yZCddID0gXCJcIlxyXG4gICAgICAgIHBvcHVsYXJbJ2NvdW50J10gPSAwO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB3b3Jkcy5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgIHZhciB3ID0gd29yZHNbaV0udG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgd29yZENvdW50c1tcIl9cIiArIHddID0gKHdvcmRDb3VudHNbXCJfXCIgKyB3XSB8fCAwKSArIDE7XHJcbiAgICAgICAgICAgIGlmKHdvcmRDb3VudHNbXCJfXCIgKyB3XSA+IHBvcHVsYXJbJ2NvdW50J10gJiYgdyAhPSBcIiBcIil7XHJcbiAgICAgICAgICAgICAgICBwb3B1bGFyWyd3b3JkJ10gPSB3O1xyXG4gICAgICAgICAgICAgICAgcG9wdWxhclsnY291bnQnXSA9IHdvcmRDb3VudHNbXCJfXCIgKyB3XTsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNvY2tldC5zZW5kKFwiMDRcIitKU09OLnN0cmluZ2lmeShwb3B1bGFyKSk7ICAgICAgICBcclxuICAgIH0gXHJcblxyXG4gICAgLy9Db2RlIDA0IC0gL3N0YXRzIGNvbW1hbmQgXHJcbiAgICBpZihjb2RlID09IFwiMDRcIil7XHJcbiAgICAgICAgLy9sb29rIGZvciBjbGllbnRcclxuICAgICAgICB2YXIgY2xpZW50Rm91bmQ7XHJcbiAgICAgICAgZm9yKHZhciBpZCBpbiBjbGllbnRzKXtcclxuICAgICAgICAgICAgaWYoY2xpZW50c1tpZF1bJ25hbWUnXSA9PSBkYXRhWyduYW1lJ10pe1xyXG4gICAgICAgICAgICAgICAgY2xpZW50Rm91bmQgPSBjbGllbnRzW2lkXTsgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYoY2xpZW50Rm91bmQpe1xyXG4gICAgICAgICAgICAvL2NsaWVudCBmb3VuZCAgICBcclxuICAgICAgICAgICAgdmFyIGFuc3dlciA9IHt9O1xyXG4gICAgICAgICAgICBhbnN3ZXJbJ25hbWUnXSA9IGNsaWVudEZvdW5kWyduYW1lJ107XHJcbiAgICAgICAgICAgIGFuc3dlclsndGltZSddID0gRGF0ZS5ub3coKSAtIGNsaWVudEZvdW5kWydqb2luJ107XHJcbiAgICAgICAgICAgIHNvY2tldC5zZW5kKFwiMDVcIitKU09OLnN0cmluZ2lmeShhbnN3ZXIpKTsgICAgICAgICAgICAgICBcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgLy9jbGllbnQgbm90IGZvdW5kXHJcbiAgICAgICAgICAgIHZhciBhbnN3ZXIgPSB7fTtcclxuICAgICAgICAgICAgYW5zd2VyWydlcnJvciddID0gXCJjbGllbnQgbm90IGZvdW5kXCI7XHJcbiAgICAgICAgICAgIHNvY2tldC5zZW5kKFwiMDVcIitKU09OLnN0cmluZ2lmeShhbnN3ZXIpKTsgICAgICAgICAgICAgICBcclxuICAgICAgICB9ICAgICAgICAgICBcclxuICAgIH0gXHJcbiAgICAgICAgXHJcbiAgfSk7XHJcblxyXG4gIC8vSGFuZGxlIGRpc2Nvbm5jZXRpb25zIGZyb20gY2xpZW50cyAgXHJcbiAgc29ja2V0Lm9uKCdjbG9zZScsIGZ1bmN0aW9uIGluY29taW5nKG1lc3NhZ2UpIHtcclxuICAgIGNvbnNvbGUubG9nKCdDbGllbnQgZGlzY29ubmVjdGVkIHdpdGggY29kZTogJXMnLCBtZXNzYWdlKTtcclxuICB9KTtcclxuXHJcbn0pO1xyXG5cclxuLy9TZXJ2ZXIgaXMgZnVsbHkgc2V0IHVwXHJcbmNvbnNvbGUubG9nKFwiQ2hhdCBzZXJ2ZXIgaXMgcnVubmluZyBhdCBsb2NhbGhvc3Q6XCIrUE9SVCk7XHJcblxyXG5cclxuLy9IZWxwZXIgZnVuY3Rpb25zXHJcbmZ1bmN0aW9uIHByb2Zhbml0eShtZXNzYWdlKXtcclxuICAgIHJldHVybiBtZXNzYWdlLnJlcGxhY2UoUFJPRkFOSVRZLCBmdW5jdGlvbihtKSB7IFxyXG4gICAgICAgIHJldHVybiBDRU5aT1Iuc3Vic3RyKDAsIG0ubGVuZ3RoKTtcclxuICAgIH0pO1xyXG59Il19