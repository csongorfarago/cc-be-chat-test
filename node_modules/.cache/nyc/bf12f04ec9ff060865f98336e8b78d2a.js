var cov_1hrcj0p82x=function(){var path="C:\\work\\chat-test\\server.js",hash="1da65edb68ac1469f3e8fdfd40517fec140fa8da",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"C:\\work\\chat-test\\server.js",statementMap:{"0":{start:{line:2,column:11},end:{line:2,column:24}},"1":{start:{line:3,column:15},end:{line:3,column:17}},"2":{start:{line:6,column:0},end:{line:11,column:3}},"3":{start:{line:7,column:4},end:{line:7,column:38}},"4":{start:{line:8,column:4},end:{line:8,column:53}},"5":{start:{line:9,column:4},end:{line:9,column:63}},"6":{start:{line:10,column:4},end:{line:10,column:65}},"7":{start:{line:14,column:18},end:{line:14,column:31}},"8":{start:{line:15,column:13},end:{line:15,column:17}},"9":{start:{line:16,column:15},end:{line:16,column:51}},"10":{start:{line:18,column:15},end:{line:18,column:17}},"11":{start:{line:19,column:14},end:{line:19,column:16}},"12":{start:{line:21,column:0},end:{line:125,column:3}},"13":{start:{line:23,column:4},end:{line:23,column:36}},"14":{start:{line:25,column:17},end:{line:25,column:19}},"15":{start:{line:26,column:4},end:{line:26,column:31}},"16":{start:{line:27,column:4},end:{line:27,column:32}},"17":{start:{line:28,column:4},end:{line:28,column:32}},"18":{start:{line:31,column:4},end:{line:31,column:49}},"19":{start:{line:34,column:4},end:{line:119,column:7}},"20":{start:{line:36,column:19},end:{line:36,column:42}},"21":{start:{line:37,column:19},end:{line:37,column:51}},"22":{start:{line:38,column:8},end:{line:38,column:95}},"23":{start:{line:41,column:8},end:{line:45,column:9}},"24":{start:{line:42,column:12},end:{line:44,column:13}},"25":{start:{line:43,column:16},end:{line:43,column:58}},"26":{start:{line:48,column:8},end:{line:65,column:9}},"27":{start:{line:49,column:23},end:{line:49,column:49}},"28":{start:{line:50,column:26},end:{line:53,column:13}},"29":{start:{line:56,column:12},end:{line:58,column:13}},"30":{start:{line:57,column:16},end:{line:57,column:33}},"31":{start:{line:59,column:12},end:{line:59,column:35}},"32":{start:{line:62,column:12},end:{line:64,column:15}},"33":{start:{line:63,column:16},end:{line:63,column:60}},"34":{start:{line:68,column:8},end:{line:94,column:9}},"35":{start:{line:69,column:20},end:{line:69,column:22}},"36":{start:{line:70,column:23},end:{line:70,column:40}},"37":{start:{line:71,column:12},end:{line:75,column:13}},"38":{start:{line:72,column:16},end:{line:74,column:17}},"39":{start:{line:73,column:20},end:{line:73,column:54}},"40":{start:{line:77,column:29},end:{line:77,column:31}},"41":{start:{line:78,column:24},end:{line:78,column:37}},"42":{start:{line:80,column:26},end:{line:80,column:28}},"43":{start:{line:81,column:12},end:{line:81,column:33}},"44":{start:{line:82,column:12},end:{line:82,column:33}},"45":{start:{line:84,column:12},end:{line:91,column:13}},"46":{start:{line:85,column:24},end:{line:85,column:46}},"47":{start:{line:86,column:16},end:{line:86,column:69}},"48":{start:{line:87,column:16},end:{line:90,column:17}},"49":{start:{line:88,column:20},end:{line:88,column:40}},"50":{start:{line:89,column:20},end:{line:89,column:59}},"51":{start:{line:93,column:12},end:{line:93,column:56}},"52":{start:{line:97,column:8},end:{line:118,column:9}},"53":{start:{line:100,column:12},end:{line:104,column:13}},"54":{start:{line:101,column:16},end:{line:103,column:17}},"55":{start:{line:102,column:20},end:{line:102,column:46}},"56":{start:{line:106,column:12},end:{line:117,column:13}},"57":{start:{line:108,column:29},end:{line:108,column:31}},"58":{start:{line:109,column:16},end:{line:109,column:53}},"59":{start:{line:110,column:16},end:{line:110,column:66}},"60":{start:{line:111,column:16},end:{line:111,column:59}},"61":{start:{line:114,column:29},end:{line:114,column:31}},"62":{start:{line:115,column:16},end:{line:115,column:53}},"63":{start:{line:116,column:16},end:{line:116,column:59}},"64":{start:{line:122,column:4},end:{line:124,column:7}},"65":{start:{line:123,column:8},end:{line:123,column:66}},"66":{start:{line:128,column:0},end:{line:128,column:59}},"67":{start:{line:132,column:4},end:{line:134,column:7}},"68":{start:{line:133,column:8},end:{line:133,column:42}},"69":{start:{line:141,column:0},end:{line:143,column:3}},"70":{start:{line:142,column:4},end:{line:142,column:13}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:43},end:{line:6,column:44}},loc:{start:{line:6,column:68},end:{line:11,column:1}},line:6},"1":{name:"connection",decl:{start:{line:21,column:33},end:{line:21,column:43}},loc:{start:{line:21,column:52},end:{line:125,column:1}},line:21},"2":{name:"incoming",decl:{start:{line:34,column:34},end:{line:34,column:42}},loc:{start:{line:34,column:52},end:{line:119,column:5}},line:34},"3":{name:"(anonymous_3)",decl:{start:{line:62,column:35},end:{line:62,column:36}},loc:{start:{line:62,column:53},end:{line:64,column:13}},line:62},"4":{name:"incoming",decl:{start:{line:122,column:32},end:{line:122,column:40}},loc:{start:{line:122,column:50},end:{line:124,column:5}},line:122},"5":{name:"profanity",decl:{start:{line:131,column:9},end:{line:131,column:18}},loc:{start:{line:131,column:28},end:{line:135,column:1}},line:131},"6":{name:"(anonymous_6)",decl:{start:{line:132,column:38},end:{line:132,column:39}},loc:{start:{line:132,column:51},end:{line:134,column:5}},line:132},"7":{name:"(anonymous_7)",decl:{start:{line:141,column:12},end:{line:141,column:13}},loc:{start:{line:141,column:17},end:{line:143,column:1}},line:141}},branchMap:{"0":{loc:{start:{line:41,column:8},end:{line:45,column:9}},type:"if",locations:[{start:{line:41,column:8},end:{line:45,column:9}},{start:{line:41,column:8},end:{line:45,column:9}}],line:41},"1":{loc:{start:{line:42,column:12},end:{line:44,column:13}},type:"if",locations:[{start:{line:42,column:12},end:{line:44,column:13}},{start:{line:42,column:12},end:{line:44,column:13}}],line:42},"2":{loc:{start:{line:48,column:8},end:{line:65,column:9}},type:"if",locations:[{start:{line:48,column:8},end:{line:65,column:9}},{start:{line:48,column:8},end:{line:65,column:9}}],line:48},"3":{loc:{start:{line:56,column:12},end:{line:58,column:13}},type:"if",locations:[{start:{line:56,column:12},end:{line:58,column:13}},{start:{line:56,column:12},end:{line:58,column:13}}],line:56},"4":{loc:{start:{line:68,column:8},end:{line:94,column:9}},type:"if",locations:[{start:{line:68,column:8},end:{line:94,column:9}},{start:{line:68,column:8},end:{line:94,column:9}}],line:68},"5":{loc:{start:{line:72,column:16},end:{line:74,column:17}},type:"if",locations:[{start:{line:72,column:16},end:{line:74,column:17}},{start:{line:72,column:16},end:{line:74,column:17}}],line:72},"6":{loc:{start:{line:86,column:39},end:{line:86,column:63}},type:"binary-expr",locations:[{start:{line:86,column:39},end:{line:86,column:58}},{start:{line:86,column:62},end:{line:86,column:63}}],line:86},"7":{loc:{start:{line:87,column:16},end:{line:90,column:17}},type:"if",locations:[{start:{line:87,column:16},end:{line:90,column:17}},{start:{line:87,column:16},end:{line:90,column:17}}],line:87},"8":{loc:{start:{line:87,column:20},end:{line:87,column:70}},type:"binary-expr",locations:[{start:{line:87,column:20},end:{line:87,column:58}},{start:{line:87,column:62},end:{line:87,column:70}}],line:87},"9":{loc:{start:{line:97,column:8},end:{line:118,column:9}},type:"if",locations:[{start:{line:97,column:8},end:{line:118,column:9}},{start:{line:97,column:8},end:{line:118,column:9}}],line:97},"10":{loc:{start:{line:101,column:16},end:{line:103,column:17}},type:"if",locations:[{start:{line:101,column:16},end:{line:103,column:17}},{start:{line:101,column:16},end:{line:103,column:17}}],line:101},"11":{loc:{start:{line:106,column:12},end:{line:117,column:13}},type:"if",locations:[{start:{line:106,column:12},end:{line:117,column:13}},{start:{line:106,column:12},end:{line:117,column:13}}],line:106}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();//Getting PROFANITY regex ready for use
const fs=(cov_1hrcj0p82x.s[0]++,require('fs'));var BADWORDS=(cov_1hrcj0p82x.s[1]++,[]);var PROFANITY;var CENZOR;cov_1hrcj0p82x.s[2]++;fs.readFile("assets/badwords.txt","utf8",function(err,contents){cov_1hrcj0p82x.f[0]++;cov_1hrcj0p82x.s[3]++;BADWORDS=contents.split('\r\n');cov_1hrcj0p82x.s[4]++;PROFANITY=new RegExp(BADWORDS.join("|"),"gi");cov_1hrcj0p82x.s[5]++;CENZOR="**********************".split("").join("******");cov_1hrcj0p82x.s[6]++;console.log('Profanity words list loaded and filter set up');});//Setting up Websocket
const WebSocket=(cov_1hrcj0p82x.s[7]++,require('ws'));const PORT=(cov_1hrcj0p82x.s[8]++,8080);const server=(cov_1hrcj0p82x.s[9]++,new WebSocket.Server({port:PORT}));var messages=(cov_1hrcj0p82x.s[10]++,[]);var clients=(cov_1hrcj0p82x.s[11]++,{});cov_1hrcj0p82x.s[12]++;server.on('connection',function connection(socket){cov_1hrcj0p82x.f[1]++;cov_1hrcj0p82x.s[13]++;//Handle new connections
console.log("Client connected");var client=(cov_1hrcj0p82x.s[14]++,{});cov_1hrcj0p82x.s[15]++;client['name']="Unknown";cov_1hrcj0p82x.s[16]++;client['join']=Date.now();cov_1hrcj0p82x.s[17]++;clients[socket.id]=client;//sending chat history
cov_1hrcj0p82x.s[18]++;socket.send("03"+JSON.stringify(messages));//Handle messages from clients  
cov_1hrcj0p82x.s[19]++;socket.on('message',function incoming(message){cov_1hrcj0p82x.f[2]++;//decoding message
var code=(cov_1hrcj0p82x.s[20]++,message.substring(0,2));var data=(cov_1hrcj0p82x.s[21]++,JSON.parse(message.substring(2)));cov_1hrcj0p82x.s[22]++;console.log('received:{ code: '+code+' , message: '+JSON.stringify(data)+' }');//Code 01 - client settings
cov_1hrcj0p82x.s[23]++;if(code=="01"){cov_1hrcj0p82x.b[0][0]++;cov_1hrcj0p82x.s[24]++;if(data['name']){cov_1hrcj0p82x.b[1][0]++;cov_1hrcj0p82x.s[25]++;clients[socket.id]['name']=data['name'];}else{cov_1hrcj0p82x.b[1][1]++;}}else{cov_1hrcj0p82x.b[0][1]++;}//Code 02 - chat message
cov_1hrcj0p82x.s[26]++;if(code=="02"){cov_1hrcj0p82x.b[2][0]++;var text=(cov_1hrcj0p82x.s[27]++,profanity(data['message']));var message=(cov_1hrcj0p82x.s[28]++,{"name":clients[socket.id]['name'],"message":text,"time":Date.now()});//keeping last 50 messages
cov_1hrcj0p82x.s[29]++;if(messages.length>=50){cov_1hrcj0p82x.b[3][0]++;cov_1hrcj0p82x.s[30]++;messages.shift();}else{cov_1hrcj0p82x.b[3][1]++;}cov_1hrcj0p82x.s[31]++;messages.push(message);//sending message object to everyone
cov_1hrcj0p82x.s[32]++;server.clients.forEach(function(client){cov_1hrcj0p82x.f[3]++;cov_1hrcj0p82x.s[33]++;client.send("02"+JSON.stringify(message));});}else{cov_1hrcj0p82x.b[2][1]++;}//Code 03 - /popular command 
cov_1hrcj0p82x.s[34]++;if(code=="03"){cov_1hrcj0p82x.b[4][0]++;var s=(cov_1hrcj0p82x.s[35]++,"");var time=(cov_1hrcj0p82x.s[36]++,Date.now()-5000);cov_1hrcj0p82x.s[37]++;for(var i=messages.length-1;i>=0;i--){cov_1hrcj0p82x.s[38]++;if(messages[i]['time']>=time){cov_1hrcj0p82x.b[5][0]++;cov_1hrcj0p82x.s[39]++;s+=messages[i]['message']+" ";}else{cov_1hrcj0p82x.b[5][1]++;}}var wordCounts=(cov_1hrcj0p82x.s[40]++,{});var words=(cov_1hrcj0p82x.s[41]++,s.split(/\b/));var popular=(cov_1hrcj0p82x.s[42]++,{});cov_1hrcj0p82x.s[43]++;popular['word']="";cov_1hrcj0p82x.s[44]++;popular['count']=0;cov_1hrcj0p82x.s[45]++;for(var i=0;i<words.length;i++){var w=(cov_1hrcj0p82x.s[46]++,words[i].toLowerCase());cov_1hrcj0p82x.s[47]++;wordCounts["_"+w]=((cov_1hrcj0p82x.b[6][0]++,wordCounts["_"+w])||(cov_1hrcj0p82x.b[6][1]++,0))+1;cov_1hrcj0p82x.s[48]++;if((cov_1hrcj0p82x.b[8][0]++,wordCounts["_"+w]>popular['count'])&&(cov_1hrcj0p82x.b[8][1]++,w!=" ")){cov_1hrcj0p82x.b[7][0]++;cov_1hrcj0p82x.s[49]++;popular['word']=w;cov_1hrcj0p82x.s[50]++;popular['count']=wordCounts["_"+w];}else{cov_1hrcj0p82x.b[7][1]++;}}cov_1hrcj0p82x.s[51]++;socket.send("04"+JSON.stringify(popular));}else{cov_1hrcj0p82x.b[4][1]++;}//Code 04 - /stats command 
cov_1hrcj0p82x.s[52]++;if(code=="04"){cov_1hrcj0p82x.b[9][0]++;//look for client
var clientFound;cov_1hrcj0p82x.s[53]++;for(var id in clients){cov_1hrcj0p82x.s[54]++;if(clients[id]['name']==data['name']){cov_1hrcj0p82x.b[10][0]++;cov_1hrcj0p82x.s[55]++;clientFound=clients[id];}else{cov_1hrcj0p82x.b[10][1]++;}}cov_1hrcj0p82x.s[56]++;if(clientFound){cov_1hrcj0p82x.b[11][0]++;//client found    
var answer=(cov_1hrcj0p82x.s[57]++,{});cov_1hrcj0p82x.s[58]++;answer['name']=clientFound['name'];cov_1hrcj0p82x.s[59]++;answer['time']=Date.now()-clientFound['join'];cov_1hrcj0p82x.s[60]++;socket.send("05"+JSON.stringify(answer));}else{cov_1hrcj0p82x.b[11][1]++;//client not found
var answer=(cov_1hrcj0p82x.s[61]++,{});cov_1hrcj0p82x.s[62]++;answer['error']="client not found";cov_1hrcj0p82x.s[63]++;socket.send("05"+JSON.stringify(answer));}}else{cov_1hrcj0p82x.b[9][1]++;}});//Handle disconncetions from clients  
cov_1hrcj0p82x.s[64]++;socket.on('close',function incoming(message){cov_1hrcj0p82x.f[4]++;cov_1hrcj0p82x.s[65]++;console.log('Client disconnected with code: %s',message);});});//Server is fully set up
cov_1hrcj0p82x.s[66]++;console.log("Chat server is running at localhost:"+PORT);//Helper functions
function profanity(message){cov_1hrcj0p82x.f[5]++;cov_1hrcj0p82x.s[67]++;return message.replace(PROFANITY,function(m){cov_1hrcj0p82x.f[6]++;cov_1hrcj0p82x.s[68]++;return CENZOR.substr(0,m.length);});}/////////////
//  TESTS  //
/////////////
import test from'ava';cov_1hrcj0p82x.s[69]++;test('foo',t=>{cov_1hrcj0p82x.f[7]++;cov_1hrcj0p82x.s[70]++;t.pass();});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlci5qcyJdLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJCQURXT1JEUyIsIlBST0ZBTklUWSIsIkNFTlpPUiIsInJlYWRGaWxlIiwiZXJyIiwiY29udGVudHMiLCJzcGxpdCIsIlJlZ0V4cCIsImpvaW4iLCJjb25zb2xlIiwibG9nIiwiV2ViU29ja2V0IiwiUE9SVCIsInNlcnZlciIsIlNlcnZlciIsInBvcnQiLCJtZXNzYWdlcyIsImNsaWVudHMiLCJvbiIsImNvbm5lY3Rpb24iLCJzb2NrZXQiLCJjbGllbnQiLCJEYXRlIiwibm93IiwiaWQiLCJzZW5kIiwiSlNPTiIsInN0cmluZ2lmeSIsImluY29taW5nIiwibWVzc2FnZSIsImNvZGUiLCJzdWJzdHJpbmciLCJkYXRhIiwicGFyc2UiLCJ0ZXh0IiwicHJvZmFuaXR5IiwibGVuZ3RoIiwic2hpZnQiLCJwdXNoIiwiZm9yRWFjaCIsInMiLCJ0aW1lIiwiaSIsIndvcmRDb3VudHMiLCJ3b3JkcyIsInBvcHVsYXIiLCJ3IiwidG9Mb3dlckNhc2UiLCJjbGllbnRGb3VuZCIsImFuc3dlciIsInJlcGxhY2UiLCJtIiwic3Vic3RyIiwidGVzdCIsInQiLCJwYXNzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBLE1BQU1BLEtBQUtDLFFBQVEsSUFBUixDQUFYO0FBQ0EsSUFBSUMsV0FBVyxFQUFmO0FBQ0EsSUFBSUMsU0FBSjtBQUNBLElBQUlDLE1BQUo7QUFDQUosR0FBR0ssUUFBSCxDQUFZLHFCQUFaLEVBQW1DLE1BQW5DLEVBQTJDLFVBQVNDLEdBQVQsRUFBY0MsUUFBZCxFQUF3QjtBQUMvREwsZUFBV0ssU0FBU0MsS0FBVCxDQUFlLE1BQWYsQ0FBWDtBQUNBTCxnQkFBYSxJQUFJTSxNQUFKLENBQVlQLFNBQVNRLElBQVQsQ0FBYyxHQUFkLENBQVosRUFBZ0MsSUFBaEMsQ0FBYjtBQUNBTixhQUFVLHdCQUFELENBQTJCSSxLQUEzQixDQUFpQyxFQUFqQyxFQUFxQ0UsSUFBckMsQ0FBMEMsUUFBMUMsQ0FB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LGtCQUFsQjtBQUNBN0IsdUJBQU9LLElBQVAsQ0FBWSxPQUFLQyxLQUFLQyxTQUFMLENBQWVzQixNQUFmLENBQWpCO0FBQ0g7QUFDSjtBQUVGLEtBdEZEOztBQXdGQTtBQUNBN0IsV0FBT0YsRUFBUCxDQUFVLE9BQVYsRUFBbUIsU0FBU1UsUUFBVCxDQUFrQkMsT0FBbEIsRUFBMkI7QUFDNUNwQixnQkFBUUMsR0FBUixDQUFZLG1DQUFaLEVBQWlEbUIsT0FBakQ7QUFDRCxLQUZEO0FBSUQsQ0E1R0Q7O0FBOEdBO0FBQ0FwQixRQUFRQyxHQUFSLENBQVkseUNBQXVDRSxJQUFuRDs7QUFHQTtBQUNBLFNBQVN1QixTQUFULENBQW1CTixPQUFuQixFQUEyQjtBQUN2QixXQUFPQSxRQUFRcUIsT0FBUixDQUFnQmpELFNBQWhCLEVBQTJCLFVBQVNrRCxDQUFULEVBQVk7QUFDMUMsZUFBT2pELE9BQU9rRCxNQUFQLENBQWMsQ0FBZCxFQUFpQkQsRUFBRWYsTUFBbkIsQ0FBUDtBQUNILEtBRk0sQ0FBUDtBQUdIOztBQUdHO0FBQ0E7QUFDQTtBQUNKLE9BQU9pQixJQUFQLE1BQWlCLEtBQWpCO0FBQ0FBLEtBQUssS0FBTCxFQUFZQyxLQUFLO0FBQ2hCQSxNQUFFQyxJQUFGO0FBQ0EsQ0FGRCIsImZpbGUiOiJzZXJ2ZXIuanMiLCJzb3VyY2VSb290IjoiQzovd29yay9jaGF0LXRlc3QiLCJzb3VyY2VzQ29udGVudCI6WyIvL0dldHRpbmcgUFJPRkFOSVRZIHJlZ2V4IHJlYWR5IGZvciB1c2VcclxuY29uc3QgZnMgPSByZXF1aXJlKCdmcycpO1xyXG52YXIgQkFEV09SRFMgPSBbXTtcclxudmFyIFBST0ZBTklUWTtcclxudmFyIENFTlpPUjtcclxuZnMucmVhZEZpbGUoXCJhc3NldHMvYmFkd29yZHMudHh0XCIsIFwidXRmOFwiLCBmdW5jdGlvbihlcnIsIGNvbnRlbnRzKSB7XHJcbiAgICBCQURXT1JEUyA9IGNvbnRlbnRzLnNwbGl0KCdcXHJcXG4nKTtcclxuICAgIFBST0ZBTklUWSAgPSBuZXcgUmVnRXhwKCBCQURXT1JEUy5qb2luKFwifFwiKSAsXCJnaVwiKTtcclxuICAgIENFTlpPUiA9IChcIioqKioqKioqKioqKioqKioqKioqKipcIikuc3BsaXQoXCJcIikuam9pbihcIioqKioqKlwiKTtcclxuICAgIGNvbnNvbGUubG9nKCdQcm9mYW5pdHkgd29yZHMgbGlzdCBsb2FkZWQgYW5kIGZpbHRlciBzZXQgdXAnKTtcclxufSk7XHJcblxyXG4vL1NldHRpbmcgdXAgV2Vic29ja2V0XHJcbmNvbnN0IFdlYlNvY2tldCA9IHJlcXVpcmUoJ3dzJyk7XHJcbmNvbnN0IFBPUlQgPSA4MDgwOyBcclxuY29uc3Qgc2VydmVyID0gbmV3IFdlYlNvY2tldC5TZXJ2ZXIoeyBwb3J0OiBQT1JUIH0pO1xyXG4gXHJcbnZhciBtZXNzYWdlcyA9IFtdOyBcclxudmFyIGNsaWVudHMgPSB7fTtcclxuIFxyXG5zZXJ2ZXIub24oJ2Nvbm5lY3Rpb24nLCBmdW5jdGlvbiBjb25uZWN0aW9uKHNvY2tldCkge1xyXG4gIC8vSGFuZGxlIG5ldyBjb25uZWN0aW9uc1xyXG4gIGNvbnNvbGUubG9nKFwiQ2xpZW50IGNvbm5lY3RlZFwiKTtcclxuICBcclxuICAgIHZhciBjbGllbnQgPSB7fTtcclxuICAgIGNsaWVudFsnbmFtZSddID0gXCJVbmtub3duXCI7XHJcbiAgICBjbGllbnRbJ2pvaW4nXSA9IERhdGUubm93KCk7XHJcbiAgICBjbGllbnRzW3NvY2tldC5pZF0gPSBjbGllbnQ7ICAgIFxyXG4gICAgXHJcbiBcclxuICAvL3NlbmRpbmcgY2hhdCBoaXN0b3J5XHJcbiAgc29ja2V0LnNlbmQoXCIwM1wiK0pTT04uc3RyaW5naWZ5KG1lc3NhZ2VzKSk7XHJcbiAgIFxyXG4gICBcclxuICAvL0hhbmRsZSBtZXNzYWdlcyBmcm9tIGNsaWVudHMgIFxyXG4gIHNvY2tldC5vbignbWVzc2FnZScsIGZ1bmN0aW9uIGluY29taW5nKG1lc3NhZ2UpIHtcclxuICAgIC8vZGVjb2RpbmcgbWVzc2FnZVxyXG4gICAgdmFyIGNvZGUgPSAgbWVzc2FnZS5zdWJzdHJpbmcoMCwgMik7XHJcbiAgICB2YXIgZGF0YSA9ICBKU09OLnBhcnNlKG1lc3NhZ2Uuc3Vic3RyaW5nKDIpKTtcclxuICAgIGNvbnNvbGUubG9nKCdyZWNlaXZlZDp7IGNvZGU6ICcrY29kZSsnICwgbWVzc2FnZTogJysgSlNPTi5zdHJpbmdpZnkoZGF0YSkgKycgfScpO1xyXG4gXHJcbiAgICAvL0NvZGUgMDEgLSBjbGllbnQgc2V0dGluZ3NcclxuICAgIGlmKGNvZGUgPT0gXCIwMVwiKXtcclxuICAgICAgICBpZihkYXRhWyduYW1lJ10pe1xyXG4gICAgICAgICAgICBjbGllbnRzW3NvY2tldC5pZF1bJ25hbWUnXSA9IGRhdGFbJ25hbWUnXTsgXHJcbiAgICAgICAgfSAgICAgICBcclxuICAgIH0gXHJcbiAgICBcclxuICAgIC8vQ29kZSAwMiAtIGNoYXQgbWVzc2FnZVxyXG4gICAgaWYoY29kZSA9PSBcIjAyXCIpe1xyXG4gICAgICAgIHZhciB0ZXh0ID0gcHJvZmFuaXR5KGRhdGFbJ21lc3NhZ2UnXSk7XHJcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSB7IFwibmFtZVwiOiBjbGllbnRzW3NvY2tldC5pZF1bJ25hbWUnXSwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibWVzc2FnZVwiOiB0ZXh0LCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0aW1lXCI6IERhdGUubm93KClcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTsgICAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy9rZWVwaW5nIGxhc3QgNTAgbWVzc2FnZXNcclxuICAgICAgICBpZihtZXNzYWdlcy5sZW5ndGggPj0gNTApe1xyXG4gICAgICAgICAgICBtZXNzYWdlcy5zaGlmdCgpOyAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBtZXNzYWdlcy5wdXNoKG1lc3NhZ2UpOyBcclxuICAgICAgICBcclxuICAgICAgICAvL3NlbmRpbmcgbWVzc2FnZSBvYmplY3QgdG8gZXZlcnlvbmVcclxuICAgICAgICBzZXJ2ZXIuY2xpZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGNsaWVudCkge1xyXG4gICAgICAgICAgICBjbGllbnQuc2VuZChcIjAyXCIrSlNPTi5zdHJpbmdpZnkobWVzc2FnZSkpO1xyXG4gICAgICAgIH0pOyAgICAgIFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvL0NvZGUgMDMgLSAvcG9wdWxhciBjb21tYW5kIFxyXG4gICAgaWYoY29kZSA9PSBcIjAzXCIpe1xyXG4gICAgICAgIHZhciBzID0gXCJcIjtcclxuICAgICAgICB2YXIgdGltZSA9IERhdGUubm93KCkgLSA1MDAwO1xyXG4gICAgICAgIGZvcih2YXIgaSA9IG1lc3NhZ2VzLmxlbmd0aC0xOyBpID49IDA7IGktLSl7XHJcbiAgICAgICAgICAgIGlmKG1lc3NhZ2VzW2ldWyd0aW1lJ10gPj0gdGltZSl7XHJcbiAgICAgICAgICAgICAgICBzKz0gbWVzc2FnZXNbaV1bJ21lc3NhZ2UnXSArIFwiIFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSAgICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICB2YXIgd29yZENvdW50cyA9IHsgfTtcclxuICAgICAgICB2YXIgd29yZHMgPSBzLnNwbGl0KC9cXGIvKTtcclxuICAgICAgICBcclxuICAgICAgICB2YXIgcG9wdWxhciA9IHt9O1xyXG4gICAgICAgIHBvcHVsYXJbJ3dvcmQnXSA9IFwiXCJcclxuICAgICAgICBwb3B1bGFyWydjb3VudCddID0gMDtcclxuICAgICAgICBcclxuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgd29yZHMubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICB2YXIgdyA9IHdvcmRzW2ldLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIHdvcmRDb3VudHNbXCJfXCIgKyB3XSA9ICh3b3JkQ291bnRzW1wiX1wiICsgd10gfHwgMCkgKyAxO1xyXG4gICAgICAgICAgICBpZih3b3JkQ291bnRzW1wiX1wiICsgd10gPiBwb3B1bGFyWydjb3VudCddICYmIHcgIT0gXCIgXCIpe1xyXG4gICAgICAgICAgICAgICAgcG9wdWxhclsnd29yZCddID0gdztcclxuICAgICAgICAgICAgICAgIHBvcHVsYXJbJ2NvdW50J10gPSB3b3JkQ291bnRzW1wiX1wiICsgd107ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzb2NrZXQuc2VuZChcIjA0XCIrSlNPTi5zdHJpbmdpZnkocG9wdWxhcikpOyAgICAgICAgXHJcbiAgICB9IFxyXG5cclxuICAgIC8vQ29kZSAwNCAtIC9zdGF0cyBjb21tYW5kIFxyXG4gICAgaWYoY29kZSA9PSBcIjA0XCIpe1xyXG4gICAgICAgIC8vbG9vayBmb3IgY2xpZW50XHJcbiAgICAgICAgdmFyIGNsaWVudEZvdW5kO1xyXG4gICAgICAgIGZvcih2YXIgaWQgaW4gY2xpZW50cyl7XHJcbiAgICAgICAgICAgIGlmKGNsaWVudHNbaWRdWyduYW1lJ10gPT0gZGF0YVsnbmFtZSddKXtcclxuICAgICAgICAgICAgICAgIGNsaWVudEZvdW5kID0gY2xpZW50c1tpZF07ICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKGNsaWVudEZvdW5kKXtcclxuICAgICAgICAgICAgLy9jbGllbnQgZm91bmQgICAgXHJcbiAgICAgICAgICAgIHZhciBhbnN3ZXIgPSB7fTtcclxuICAgICAgICAgICAgYW5zd2VyWyduYW1lJ10gPSBjbGllbnRGb3VuZFsnbmFtZSddO1xyXG4gICAgICAgICAgICBhbnN3ZXJbJ3RpbWUnXSA9IERhdGUubm93KCkgLSBjbGllbnRGb3VuZFsnam9pbiddO1xyXG4gICAgICAgICAgICBzb2NrZXQuc2VuZChcIjA1XCIrSlNPTi5zdHJpbmdpZnkoYW5zd2VyKSk7ICAgICAgICAgICAgICAgXHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIC8vY2xpZW50IG5vdCBmb3VuZFxyXG4gICAgICAgICAgICB2YXIgYW5zd2VyID0ge307XHJcbiAgICAgICAgICAgIGFuc3dlclsnZXJyb3InXSA9IFwiY2xpZW50IG5vdCBmb3VuZFwiO1xyXG4gICAgICAgICAgICBzb2NrZXQuc2VuZChcIjA1XCIrSlNPTi5zdHJpbmdpZnkoYW5zd2VyKSk7ICAgICAgICAgICAgICAgXHJcbiAgICAgICAgfSAgICAgICAgICAgXHJcbiAgICB9IFxyXG4gICAgICAgIFxyXG4gIH0pO1xyXG5cclxuICAvL0hhbmRsZSBkaXNjb25uY2V0aW9ucyBmcm9tIGNsaWVudHMgIFxyXG4gIHNvY2tldC5vbignY2xvc2UnLCBmdW5jdGlvbiBpbmNvbWluZyhtZXNzYWdlKSB7XHJcbiAgICBjb25zb2xlLmxvZygnQ2xpZW50IGRpc2Nvbm5lY3RlZCB3aXRoIGNvZGU6ICVzJywgbWVzc2FnZSk7XHJcbiAgfSk7XHJcblxyXG59KTtcclxuXHJcbi8vU2VydmVyIGlzIGZ1bGx5IHNldCB1cFxyXG5jb25zb2xlLmxvZyhcIkNoYXQgc2VydmVyIGlzIHJ1bm5pbmcgYXQgbG9jYWxob3N0OlwiK1BPUlQpO1xyXG5cclxuXHJcbi8vSGVscGVyIGZ1bmN0aW9uc1xyXG5mdW5jdGlvbiBwcm9mYW5pdHkobWVzc2FnZSl7XHJcbiAgICByZXR1cm4gbWVzc2FnZS5yZXBsYWNlKFBST0ZBTklUWSwgZnVuY3Rpb24obSkgeyBcclxuICAgICAgICByZXR1cm4gQ0VOWk9SLnN1YnN0cigwLCBtLmxlbmd0aCk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuXHJcbiAgICAvLy8vLy8vLy8vLy8vXHJcbiAgICAvLyAgVEVTVFMgIC8vXHJcbiAgICAvLy8vLy8vLy8vLy8vXHJcbmltcG9ydCB0ZXN0IGZyb20gJ2F2YSc7XHJcbnRlc3QoJ2ZvbycsIHQgPT4ge1xyXG5cdHQucGFzcygpO1xyXG59KTsiXX0=