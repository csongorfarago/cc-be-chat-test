{"version":3,"sources":["index.js"],"names":["inquirer","require","WebSocket","ws","on","open","console","log","incoming","message","code","substring","data","JSON","parse","forEach","run","formatSeconds","name","askName","send","answers","askChat","split","replace","questions","type","prompt","s","stringify","seconds","sec_num","parseInt","day","Math","floor","hours","minutes"],"mappings":"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","file":"index.js","sourceRoot":"C:/work/chat-test","sourcesContent":["const inquirer = require('inquirer');\r\nconst WebSocket = require('ws');  \r\nconst ws = new WebSocket('ws://localhost:8080'); \r\n\r\nws.on('open', function open() {\r\n    console.log('server is connected');\r\n});\r\n\r\nws.on('message', function incoming(message) {\r\n    var code =  message.substring(0, 2);\r\n    var data =  JSON.parse(message.substring(2));\r\n    \r\n    //Code 02 - chat message\r\n    if(code == \"02\"){\r\n        console.log('[%s]: %s', data[\"name\"], data[\"message\"]);    \r\n    }  \r\n    \r\n    //Code 03 - receiving chat history\r\n    if(code == \"03\"){\r\n        data.forEach(function (message){\r\n            console.log('[%s]: %s', message[\"name\"], message[\"message\"]); \r\n        });  \r\n        \r\n        //History recieved asking for client's name\r\n        run();  \r\n    }  \r\n    \r\n    //Code 04 - receiving answer for /popular\r\n    if(code == \"04\"){\r\n        console.log(data['word']);\r\n    }\r\n \r\n    //Code 05 - receiving answer for /stats\r\n    if(code == \"05\"){\r\n        console.log(formatSeconds(data['time']));\r\n    } \r\n    \r\n});\r\n\r\nws.on('close', function incoming(data) {\r\n  console.log('server is disconnected');\r\n});\r\n\r\n\r\n\r\nconst run = async () => {\r\n  const { name } = await askName();\r\n  \r\n    var data = {};\r\n    data['name'] = name; \r\n    send(\"01\", data);\r\n\r\n  while (true) {\r\n    const answers = await askChat();\r\n    const { message } = answers;\r\n  \r\n    if(message[0] == \"/\") {\r\n        switch(message.split(\" \")[0]){\r\n            case \"/popular\":\r\n                send(\"03\", \"\");\r\n                break;\r\n            case \"/stats\":\r\n                var data = {};\r\n                data['name'] = message.replace(\"/stats \",\"\");   \r\n                send(\"04\", data);\r\n                break;\r\n            default:\r\n                console.log(\"Not supported commad\");\r\n        }\r\n    }else{\r\n        var data = {};\r\n        data['message'] = message; \r\n        send(\"02\", data);    \r\n    }    \r\n  }\r\n};\r\n\r\nconst askChat = () => {\r\n  const questions = [\r\n    {\r\n      name: \"message\",\r\n      type: \"input\",\r\n      message: \"Enter chat message:\"\r\n    }\r\n  ];\r\n  return inquirer.prompt(questions);\r\n};\r\n\r\nconst askName = () => {\r\n  const questions = [\r\n    {\r\n      name: \"name\",\r\n      type: \"input\",\r\n      message: \"Enter your name:\"\r\n    }\r\n  ];\r\n  return inquirer.prompt(questions);\r\n};\r\n\r\n//helpre functions\r\nfunction send(code, data){\r\n    var s = code;\r\n    s+= JSON.stringify(data);\r\n    ws.send(s);\r\n}\r\n\r\nfunction formatSeconds(seconds){\r\n    var sec_num = parseInt(seconds/1000);\r\n      \r\n    var day = Math.floor(sec_num / 86400);  \r\n    if(day < 10){ day = \"0\"+day; }\r\n    day += \"d\";\r\n    \r\n    var hours   = Math.floor(sec_num / 3600) % 24;\r\n    if(hours < 10){ hours = \"0\"+hours; }\r\n    hours += \"h\";\r\n    \r\n    var minutes = Math.floor(sec_num / 60) % 60;\r\n    if(minutes < 10){ minutes = \"0\"+minutes; }\r\n    minutes += \"m\";\r\n    \r\n    var seconds = sec_num % 60;\r\n    if(seconds < 10){ seconds = \"0\"+seconds; }    \r\n    seconds += \"s\";\r\n    \r\n    return day +\" \"+ hours +\" \"+ minutes +\" \"+ seconds;  \r\n}\r\n"]}